---
title: "Travis CI issues on a Symfony2 private Github repository"
layout: post
categories: testing travis symfony2
---
While trying to integrate one of our applications with [Travis CI][travis], I wanted to add continous integration to it. Since we are so lucky that our company - [Social Point](http://www.socialpoint.es) - provides all the tools we want for this purposes, I started spending a few spare moments on configuring it.

The premises were _**easy**_:
* Configure an automated environment for testing in your projects
* You are done!

It might look like it was a 15 minutes task, but it was **not**. A few problems arose.

### Error missing bootstrap.php.cache (not found)
[Travis CI][travis] log was complaining that it was unable to find the bootstrap.php.cache file. Since I know this file should be autogenerated, this was weird.

In the end I discovered it was due to the fact taht we have a peculiar structure in this particular project.

The symfony2 project is contained in a Symfony folder, so you needed to add the following code, in order to work straight like the examples you can find around the net.

```
before_script:
  - cd Symfony
```

<blockquote>
  <p>
    Never <strong>ever</strong> use custom folder structures. Unless you like pain.
  </p>
  <footer><cite title="Albert Camps">Albert Camps</cite></footer>
</blockquote>

### Fatal error: Class 'Symfony\Bundle\FrameworkBundle\Test\WebTestCase' not found
This error ocurred in one of my desperate efforts to solve the previous error.

I tried to remove the `bootstrap = "bootstrap.php.cache"` comment in `phpunit.xml` and `phpunit.xml.dist`.

It doesn't work out, when composer gets properly executed in your home folder, it will give you your desired `bootstrap.php.cache`.

As per Symfony2 2.4 you can execute the following to recreate `bootstrap.php.cache`.

```
cd vendor/sensio
php SensioDistributionBundle/Resources/bin/build_bootstrap.php
```

### Issues with tests using `file_get_contents`

### Issues with Symfony2 version on composer.json
https://github.com/symfony/AsseticBundle/issues/223 -- Issues with symfony

It hasn't been easy to sort everything out, but once it's done, you feel fantastic. After all issues faded, I wanted to include the following improvement:

### Add cache for faster enviroment execution

### How it adds up
```
language: php

php:
  - 5.4
  - 5.5
  - '7'

env:
  - SYMFONY_VERSION=2.4.*
  - SYMFONY_VERSION=dev-master

cache:
  directories:
    - Symfony/vendor
    - $HOME/.composer/cache

before_script:
  - cd Symfony
  - travis_retry composer self-update && composer --version
  - travis_retry composer config --global github-oauth.github.com tokeNtokEntoKentOkenToken
  - travis_retry composer require symfony/symfony:${SYMFONY_VERSION}
  - travis_retry composer install --no-interaction --prefer-dist

script: bin/phpunit --coverage-text -c app

matrix:
  allow_failures:
    - env: SYMFONY_VERSION=dev-master
```
http://russellscottwalker.blogspot.com.es/2014/01/phpunit-cannot-open-file-bootstrapphp.html
http://docs.travis-ci.com/user/languages/php/
http://vvv.tobiassjosten.net/symfony/continuous-integration-for-your-symfony2-app/


Error missing bootstrap.php.cache (not found)
Fatal error: Class 'Symfony\Bundle\FrameworkBundle\Test\WebTestCase' not found

Use composer install

https://github.com/okulbilisim/ojs -- as a reference
http://php-and-symfony.matthiasnoback.nl/2011/10/symfony2-use-a-bootstrap-file-for-your-phpunit-tests-and-run-some-console-commands/ -- more info in bootstrappin

https://github.com/symfony/AsseticBundle/issues/223 -- Issues with symfony

issues with tests using `file_get_contents`

Adding a cache https://github.com/yiisoft/yii2/blob/master/.travis.yml

Github limiting the number of requests --> change to prefer source.
https://github.com/composer/composer/issues/1861
http://help.pagodabox.com/customer/portal/questions/6193893-failed-to-download-doctrine-common-from-dist-could-not-authenticate-against-github-com
https://gist.github.com/h4cc/7680054

276154a26e4a45c72b4ca139c3afd19fc4d08c9c

1f53c4f9bea95ba64967656fef0aebe538b1848e
